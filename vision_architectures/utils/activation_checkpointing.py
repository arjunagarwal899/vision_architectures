# AUTOGENERATED! DO NOT EDIT! File to edit: ../../nbs/utils/01_activation_checkpointing.ipynb.

# %% auto 0
__all__ = ['ActivationCheckpointing']

# %% ../../nbs/utils/01_activation_checkpointing.ipynb 2
from typing import Callable

from torch.utils.checkpoint import checkpoint

# %% ../../nbs/utils/01_activation_checkpointing.ipynb 4
class ActivationCheckpointing():
    def __init__(self, fn_checkpoint_level: int, training_checkpoint_level: int):
        super().__init__()

        self.perform_checkpointing = (fn_checkpoint_level <= training_checkpoint_level)

    def __call__(self, fn: Callable, *args, **kwargs):
        if self.perform_checkpointing:
            return checkpoint(lambda: fn(*args, **kwargs), use_reentrant=False)
        return fn(*args)
